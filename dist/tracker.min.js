(()=>{var d=class{constructor(t={}){let e={acceptOrigins:[],acceptFormIds:[],ignorePathnames:[],ignoreClasses:[],ignoreProtocols:["mailto:","tel:"],dataItems:[],attributes:[],includeParams:["utm_source","utm_medium","utm_campaign","utm_id","utm_term","utm_content"],excludeParams:[]};if(!t.acceptOrigins||t.acceptOrigins.length===0)throw new Error("ParamTracker: The 'acceptOrigins' property is mandatory in the configuration.");this.config={...e,...t,acceptOrigins:this.sanitizeStringArray(t.acceptOrigins),acceptFormIds:this.sanitizeStringArray(t.acceptFormIds||[]),ignorePathnames:this.mergeUnique(e.ignorePathnames,t.ignorePathnames),ignoreClasses:this.mergeUnique(e.ignoreClasses,t.ignoreClasses),ignoreProtocols:this.mergeUnique(e.ignoreProtocols,t.ignoreProtocols),dataItems:this.mergeUnique(e.dataItems,t.dataItems),attributes:this.mergeUnique(e.attributes,t.attributes),excludeParams:this.mergeUnique(e.excludeParams,t.excludeParams)},document.addEventListener("DOMContentLoaded",()=>this.init())}init=()=>{this.sanitizeLinks(),this.bindLinkEvents(),this.bindButtonEvents(),this.restoreScrollHash()};sanitizeStringArray=(t=[])=>Array.isArray(t)?[...new Set(t.filter(e=>typeof e=="string"&&e.trim()!=="").map(e=>e.trim()))]:[];mergeUnique=(t=[],e=[])=>this.sanitizeStringArray([...t,...e]);sanitizeLinks=()=>{document.querySelectorAll("a[href]").forEach(t=>{if(!this.shouldHandleLink(t))return;let e=new URL(t.href),r=e.hash||"",n=this.sanitizeAndMergeParams(e.origin+e.pathname,e.search,"",this.config.excludeParams)+r;n!==t.href&&(t.href=n)})};isFileUrl=t=>{let e=/\.(pdf|docx?|xlsx?|pptx?|zip|rar|mp3|mp4|avi|wmv|mov|txt|csv|jpe?g|png|gif|svg|webp)(\?.*)?$/i;try{let{pathname:r,search:a,hash:n}=new URL(t),s=r+a+n;return e.test(s)}catch{return!1}};shouldHandleLink=t=>{let{ignoreClasses:e,ignoreProtocols:r,dataItems:a,attributes:n}=this.config,s=t.getAttribute("href")||"";if(e.some(i=>t.classList.contains(i))||r.some(i=>s.startsWith(i))||isFileUrl(s))return!1;for(let i of n){let o=t.getAttribute(i);if(o&&a.includes(o))return!1}return!0};isAcceptedOrigin=t=>{try{let{hostname:e}=new URL(t);return this.config.acceptOrigins.some(r=>{let a=r.trim().toLowerCase();return e===a||e.endsWith(`.${a}`)})}catch{return!1}};handleLinkClick=(t,e)=>{let r=e.origin,a=e.pathname,n=e.getAttribute("target"),s=e.hash,i=r+a;if(this.isAcceptedOrigin(r)&&!this.config.ignorePathnames.some(o=>a.includes(o))){let{href:o,isHashSymbolPresent:c}=this.generateHref(e,r,a,s);this.handleLinkRedirect(t,c,o,i,s,n)}};sanitizeAndMergeParams=(t,e="",r="",a=[])=>{try{let n=this.normalizeQueryString(e),s=new URLSearchParams((r||"").replace(/^[?&]+/,""));for(let[o,c]of n.entries()){let h=o.toLowerCase();this.config.includeParams.includes(h)&&s.has(o)||s.set(o,c)}a.forEach(o=>s.delete(o));let i=s.toString();return i?`${t}?${i}`:t}catch(n){return console.error("[sanitizeAndMergeParams] erro:",n),t}};normalizeQueryString=t=>{let e=(t||"").replace(/^[?&]+/,""),r=new URLSearchParams;for(;e;){let[n,s]=e.split(/\?(.+)/s),i=new URLSearchParams(n);for(let[o,c]of i)r.append(o,c);if(!s)break;e=s}let a=Array.from(r.entries());for(let[n,s]of a)if(s.includes("%3F")||s.includes("%3f")){let i=decodeURIComponent(s);if(i.includes("?")){let[o,c]=i.split(/\?(.+)/s);r.set(n,o);let h=new URLSearchParams(c);for(let[l,m]of h)r.has(l)||r.append(l,m)}}return r};generateHref=(t,e,r,a)=>{let{excludeParams:n}=this.config,s=e+r,i=new URL(t.href),o=this.sanitizeAndMergeParams(s,i.search,window.location.search,n),c=!!a;return{href:o+(c?a:""),isHashSymbolPresent:c}};handleLinkRedirect=(t,e,r,a,n,s)=>{t.preventDefault();let i=window.location.origin+window.location.pathname;if(e&&a===i&&n){document.querySelector(n)?.scrollIntoView({behavior:"smooth"});return}s==="_blank"?window.open(r,"_blank"):window.location.href=r};removeURLParams=t=>{let e=new URLSearchParams(t);return this.config.excludeParams.forEach(r=>e.delete(r)),e.toString()?"?"+e.toString():""};addParamsToForm=t=>{let e=window.location.hash,r=e.includes("?")?"?"+e.split("?")[1]:window.location.search;if(r){let a=new URLSearchParams(this.removeURLParams(r));for(let[n,s]of a){let i=document.createElement("input");i.type="hidden",i.name=n,i.value=s,t.appendChild(i)}}};bindLinkEvents=()=>{document.addEventListener("click",t=>{let e=t.target.closest("a");!e||!this.shouldHandleLink(e)||this.handleLinkClick(t,e)})};bindButtonEvents=()=>{document.addEventListener("click",t=>{let e=t.target.closest("button, input[type='submit']");if(!e)return;let r=e.closest("form");if(!r)return;this.config.acceptFormIds.some(n=>r.id.includes(n))&&this.addParamsToForm(r)})};restoreScrollHash=()=>{window.location.hash&&document.querySelector(window.location.hash)?.scrollIntoView({behavior:"smooth"})}};})();
