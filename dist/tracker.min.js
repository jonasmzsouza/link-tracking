/*! ParamTracker 2.1.0 | MIT License | (c) Jonas Souza 2025 | https://github.com/jonasmzsouza/param-tracker */
(()=>{var d=class{constructor(e={}){let t={acceptOrigins:[],acceptFormIds:[],ignorePathnames:[],ignoreClasses:[],ignoreProtocols:["mailto:","tel:"],dataItems:[],attributes:[],includeParams:["utm_source","utm_medium","utm_campaign","utm_id","utm_term","utm_content"],excludeParams:[]};if(!e.acceptOrigins||e.acceptOrigins.length===0)throw new Error("ParamTracker: The 'acceptOrigins' property is mandatory in the configuration.");this.config={...t,...e,acceptOrigins:this.sanitizeStringArray(e.acceptOrigins),acceptFormIds:this.sanitizeStringArray(e.acceptFormIds||[]),ignorePathnames:this.mergeUnique(t.ignorePathnames,e.ignorePathnames),ignoreClasses:this.mergeUnique(t.ignoreClasses,e.ignoreClasses),ignoreProtocols:this.mergeUnique(t.ignoreProtocols,e.ignoreProtocols),dataItems:this.mergeUnique(t.dataItems,e.dataItems),attributes:this.mergeUnique(t.attributes,e.attributes),excludeParams:this.mergeUnique(t.excludeParams,e.excludeParams)},document.addEventListener("DOMContentLoaded",()=>this.init())}init=()=>{this.sanitizeLinks(),this.bindLinkEvents(),this.bindButtonEvents(),this.restoreScrollHash()};sanitizeStringArray=(e=[])=>Array.isArray(e)?[...new Set(e.filter(t=>typeof t=="string"&&t.trim()!=="").map(t=>t.trim()))]:[];mergeUnique=(e=[],t=[])=>this.sanitizeStringArray([...e,...t]);sanitizeLinks=()=>{document.querySelectorAll("a[href]").forEach(e=>{if(!this.shouldHandleLink(e))return;let t=new URL(e.href),r=t.hash||"",n=this.sanitizeAndMergeParams(t.origin+t.pathname,t.search,"",this.config.excludeParams)+r;n!==e.href&&(e.href=n)})};isFileUrl=e=>{let t=/\.(pdf|docx?|xlsx?|pptx?|zip|rar|mp3|mp4|avi|wmv|mov|txt|csv|jpe?g|png|gif|svg|webp)(\?.*)?$/i;try{let{pathname:r,search:i,hash:n}=new URL(e),s=r+i+n;return t.test(s)}catch{return!1}};shouldHandleLink=e=>{let{ignoreClasses:t,ignoreProtocols:r,dataItems:i,attributes:n}=this.config,s=e.getAttribute("href")||"";if(t.some(o=>e.classList.contains(o))||r.some(o=>s.startsWith(o))||isFileUrl(s))return!1;for(let o of n){let a=e.getAttribute(o);if(a&&i.includes(a))return!1}return!0};isAcceptedOrigin=e=>{try{let{hostname:t}=new URL(e);return this.config.acceptOrigins.some(r=>{let i=r.trim().toLowerCase();return t===i||t.endsWith(`.${i}`)})}catch{return!1}};handleLinkClick=(e,t)=>{let r=t.origin,i=t.pathname,n=t.getAttribute("target"),s=t.hash,o=r+i;if(this.isAcceptedOrigin(r)&&!this.config.ignorePathnames.some(a=>i.includes(a))){let{href:a,isHashSymbolPresent:c}=this.generateHref(t,r,i,s);this.handleLinkRedirect(e,c,a,o,s,n)}};sanitizeAndMergeParams=(e,t="",r="",i=[])=>{try{let n=this.normalizeQueryString(t),s=new URLSearchParams((r||"").replace(/^[?&]+/,""));for(let[a,c]of n.entries()){let l=a.toLowerCase();this.config.includeParams.includes(l)&&s.has(a)||s.set(a,c)}i.forEach(a=>s.delete(a));let o=s.toString();return o?`${e}?${o}`:e}catch(n){return console.error("[sanitizeAndMergeParams] erro:",n),e}};normalizeQueryString=e=>{let t=(e||"").replace(/^[?&]+/,""),r=new URLSearchParams;for(;t;){let[n,s]=t.split(/\?(.+)/s),o=new URLSearchParams(n);for(let[a,c]of o)r.append(a,c);if(!s)break;t=s}let i=Array.from(r.entries());for(let[n,s]of i)if(s.includes("%3F")||s.includes("%3f")){let o=decodeURIComponent(s);if(o.includes("?")){let[a,c]=o.split(/\?(.+)/s);r.set(n,a);let l=new URLSearchParams(c);for(let[h,m]of l)r.has(h)||r.append(h,m)}}return r};generateHref=(e,t,r,i)=>{let{excludeParams:n}=this.config,s=t+r,o=new URL(e.href),a=this.sanitizeAndMergeParams(s,o.search,window.location.search,n),c=!!i;return{href:a+(c?i:""),isHashSymbolPresent:c}};handleLinkRedirect=(e,t,r,i,n,s)=>{e.preventDefault();let o=window.location.origin+window.location.pathname;if(t&&i===o&&n){document.querySelector(n)?.scrollIntoView({behavior:"smooth"});return}s==="_blank"?window.open(r,"_blank"):window.location.href=r};removeURLParams=e=>{let t=new URLSearchParams(e);return this.config.excludeParams.forEach(r=>t.delete(r)),t.toString()?"?"+t.toString():""};addParamsToForm=e=>{if(!(e instanceof HTMLFormElement))return;let t=window.location.hash,r=t.includes("?")?"?"+t.split("?")[1]:window.location.search;if(!r)return;let i=new URLSearchParams(this.removeURLParams(r));for(let[n,s]of i)if(!e.querySelector(`input[name="${CSS.escape(n)}"][value="${CSS.escape(s)}"]`)){let a=document.createElement("input");a.type="hidden",a.name=n,a.value=s,e.appendChild(a)}};bindLinkEvents=()=>{document.addEventListener("click",e=>{let t=e.target.closest("a");!t||!this.shouldHandleLink(t)||this.handleLinkClick(e,t)})};bindButtonEvents=()=>{document.addEventListener("click",e=>{let t=e.target.closest("button, input[type='submit']");if(!t)return;let r=t.closest("form");if(!r)return;this.config.acceptFormIds.some(n=>r.id.includes(n))&&this.addParamsToForm(r)})};restoreScrollHash=()=>{window.location.hash&&document.querySelector(window.location.hash)?.scrollIntoView({behavior:"smooth"})}};(function(u,e){typeof module=="object"&&typeof module.exports=="object"?module.exports=e():typeof define=="function"&&define.amd?define([],e):u.ParamTracker=e().ParamTracker})(typeof globalThis<"u"?globalThis:typeof window<"u"?window:void 0,function(){return{ParamTracker:d}});})();
