/*! ParamTracker 3.0.1 | MIT License | (c) Jonas Souza 2025 | https://github.com/jonasmzsouza/param-tracker */
(()=>{var u=class{constructor(e={}){let t={form:{acceptFormIds:[]},link:{acceptOrigins:[window?.location?.hostname?.toLowerCase()||""],ignorePathnames:[],ignoreClasses:[],ignoreProtocols:["mailto:","tel:","sms:","file:","blob:","data:","ftp:","ftps:","javascript:"],ignoreAttrValues:[],manageAttributes:[],includeParams:["utm_source","utm_medium","utm_campaign","utm_id","utm_term","utm_content"],excludeParams:[]}};this.config=this.mergeConfig(t,e),document.addEventListener("DOMContentLoaded",()=>this.init())}init=()=>{this.sanitizeLinks(),this.bindLinkEvents(),this.bindButtonEvents(),this.restoreScrollHash()};sanitizeStringArray=(e=[],t={})=>{if(!Array.isArray(e))return[];let{lowercase:n=!1,ensureColon:r=!1}=t,s=e.filter(i=>typeof i=="string"&&i.trim()!=="").map(i=>{let o=i.trim();return n&&(o=o.toLowerCase()),r&&!o.endsWith(":")&&(o+=":"),o});return[...new Set(s)]};mergeUnique=(e=[],t=[],n={})=>{let r=Array.isArray(e)?e:[],s=Array.isArray(t)?t:[];return this.sanitizeStringArray([...r,...s],n)};mergeConfig=(e,t={})=>{let n=t.form&&typeof t.form=="object"?t.form:{},r=t.link&&typeof t.link=="object"?t.link:{};return{form:{acceptFormIds:this.mergeUnique(e.form?.acceptFormIds,n.acceptFormIds)},link:{acceptOrigins:this.mergeUnique(e.link?.acceptOrigins,r.acceptOrigins,{lowercase:!0}),ignorePathnames:this.mergeUnique(e.link?.ignorePathnames,r.ignorePathnames,{lowercase:!0}),ignoreClasses:this.mergeUnique(e.link?.ignoreClasses,r.ignoreClasses),ignoreProtocols:this.mergeUnique(e.link?.ignoreProtocols,r.ignoreProtocols,{lowercase:!0,ensureColon:!0}),ignoreAttrValues:this.mergeUnique(e.link?.ignoreAttrValues,r.ignoreAttrValues),manageAttributes:this.mergeUnique(e.link?.manageAttributes,r.manageAttributes,{lowercase:!0}),includeParams:this.mergeUnique(e.link?.includeParams,r.includeParams,{lowercase:!0}),excludeParams:this.mergeUnique(e.link?.excludeParams,r.excludeParams,{lowercase:!0})}}};sanitizeLinks=()=>{document.querySelectorAll("a[href]").forEach(e=>{if(!this.shouldHandleLink(e))return;let t=new URL(e.href),n=t.hash||"",s=this.sanitizeAndMergeParams(t.origin+t.pathname,t.search,"",this.config.link.excludeParams)+n;s!==e.href&&(e.href=s)})};isFileUrl=(()=>{let e=["pdf","doc","docx","rtf","txt","md","json","xls","xlsx","csv","ppt","pptx","jpg","jpeg","png","gif","bmp","svg","avif","webp","mp3","wav","aac","mid","midi","flac","ogg","mp4","avi","mov","wmv","mkv","webm","zip","rar","7z","tar","gz","bz2","tar.gz","tar.bz2","exe","msi","dll","sys","bat","sh","css","js","php","xml","ts","jsx","tsx","vue","ini","conf","cfg","env","yaml","yml"],t=new RegExp(`\\.(${e.join("|")})$`,"i");return function(n){if(typeof n!="string"||n.trim()==="")return!1;try{let r=n.startsWith("http")?n:`https://${n.replace(/^\/+/,"")}`,{pathname:s}=new URL(r);return t.test(s)}catch{return!1}}})();shouldHandleLink=e=>{let{ignoreClasses:t,ignoreProtocols:n,ignoreAttrValues:r,manageAttributes:s}=this.config.link,i=e.getAttribute("href")||"";if(t.some(o=>e.classList.contains(o))||n.some(o=>i.startsWith(o))||this.isFileUrl(i))return!1;for(let o of s){let a=e.getAttribute(o);if(a&&r.includes(a))return!1}return!0};isAcceptedOrigin=e=>{try{let t=e.startsWith("http")?e:`https://${e}`,{hostname:n}=new URL(t);return this.config.link.acceptOrigins.some(r=>{let s=r.trim().toLowerCase();return n===s||n.endsWith(`.${s}`)})}catch{return!1}};handleLinkClick=(e,t)=>{let n=t.origin,r=t.pathname,s=t.getAttribute("target"),i=t.hash,o=n+r;if(this.isAcceptedOrigin(n)&&!this.config.link.ignorePathnames.some(a=>r.includes(a))){let{href:a,isHashSymbolPresent:c}=this.generateHref(t,n,r,i);this.handleLinkRedirect(e,c,a,o,i,s)}};sanitizeAndMergeParams=(e,t="",n="",r=[])=>{try{let s=this.normalizeQueryString(t),i=new URLSearchParams((n||"").replace(/^[?&]+/,""));for(let[a,c]of s.entries()){let l=a.toLowerCase();this.config.link.includeParams.includes(l)&&i.has(a)||i.set(a,c)}r.forEach(a=>i.delete(a));let o=i.toString();return o?`${e}?${o}`:e}catch(s){return console.error("[sanitizeAndMergeParams] erro:",s),e}};normalizeQueryString=e=>{let t=(e||"").replace(/^[?&]+/,""),n=new URLSearchParams;for(;t;){let[s,i]=t.split(/\?(.+)/s),o=new URLSearchParams(s);for(let[a,c]of o)n.append(a,c);if(!i)break;t=i}let r=Array.from(n.entries());for(let[s,i]of r)if(i.includes("%3F")||i.includes("%3f")){let o=decodeURIComponent(i);if(o.includes("?")){let[a,c]=o.split(/\?(.+)/s);n.set(s,a);let l=new URLSearchParams(c);for(let[m,d]of l)n.has(m)||n.append(m,d)}}return n};generateHref=(e,t,n,r)=>{let{excludeParams:s}=this.config.link,i=t+n,o=new URL(e.href),a=this.sanitizeAndMergeParams(i,o.search,window.location.search,s),c=!!r;return{href:a+(c?r:""),isHashSymbolPresent:c}};handleLinkRedirect=(e,t,n,r,s,i)=>{e.preventDefault();let o=window.location.origin+window.location.pathname;if(t&&r===o&&s){document.querySelector(s)?.scrollIntoView({behavior:"smooth"});return}i==="_blank"?window.open(n,"_blank"):window.location.href=n};removeURLParams=e=>{let t=new URLSearchParams(e);return this.config.link.excludeParams.forEach(n=>t.delete(n)),t.toString()?"?"+t.toString():""};addParamsToForm=e=>{if(!(e instanceof HTMLFormElement))return;let t=window.location.hash,n=t.includes("?")?"?"+t.split("?")[1]:window.location.search;if(!n)return;let r=new URLSearchParams(this.removeURLParams(n));for(let[s,i]of r)if(!e.querySelector(`input[name="${CSS.escape(s)}"][value="${CSS.escape(i)}"]`)){let a=document.createElement("input");a.type="hidden",a.name=s,a.value=i,e.appendChild(a)}};bindLinkEvents=()=>{document.addEventListener("click",e=>{let t=e.target.closest("a");!t||!this.shouldHandleLink(t)||this.handleLinkClick(e,t)})};bindButtonEvents=()=>{document.addEventListener("click",e=>{let t=e.target.closest("button, input[type='submit']");if(!t)return;let n=t.closest("form");if(!n)return;this.config.form.acceptFormIds.some(s=>n.id.includes(s))&&this.addParamsToForm(n)})};restoreScrollHash=()=>{window.location.hash&&document.querySelector(window.location.hash)?.scrollIntoView({behavior:"smooth"})}};(function(h,e){typeof module=="object"&&typeof module.exports=="object"?module.exports=e():typeof define=="function"&&define.amd?define([],e):h.ParamTracker=e().ParamTracker})(typeof globalThis<"u"?globalThis:typeof window<"u"?window:void 0,function(){return{ParamTracker:u}});})();
